<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>MSS TurnJS Example</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link href="css/resize-style.css" rel="stylesheet">     
  </head>
  <body>
    <div id="options">
      <div id="zoom-control">
        <button id="zoom-out">
          <span class="material-icons-outlined">remove</span>
        </button>
        <span>Zoom</span>
        <button id="zoom-in">
          <span class="material-icons-outlined">add</span>
        </button>
      </div>
      <a class="option-button" target="_blank" href="pdf/Mr_Jorrock's_Vesta_Cases.pdf">View as PDF</a>
    </div>    
    
    <div id="flipbookholder">
      <button class="left-button">
        <span class="material-icons-outlined">chevron_left</span>
      </button>      
      <div id="flipbook">      
        <div><img src="pages/1.png"></div>
        <div><img src="pages/2.png"></div>
        <div><img src="pages/3.png"></div>
        <div><img src="pages/4.png"></div>
        <div><img src="pages/5.png"></div>
        <div><img src="pages/6.png"></div>
        <div><img src="pages/7.png"></div>
        <div><img src="pages/8.png"></div>
        <div><img src="pages/9.png"></div>
      </div>
      <button class="right-button">
        <span class="material-icons-outlined">chevron_right</span>
      </button>
    </div>

    <div id="mobile-nav">
      <button class="left-button">
        <span class="material-icons-outlined">chevron_left</span>
      </button>  
      <button class="right-button">
        <span class="material-icons-outlined">chevron_right</span>
      </button>
    </div>

    <script src="js/jquery-popper-bootstrap.js"></script>
    <script src="js/turn.js"></script>
    <script type="text/javascript">

      $( "<div class='gradient'></div>" ).insertBefore( "img" );

      let displayMode = $(window).width() > 600 ? "double" : "single";
      let bookWidth = displayMode === "double" ? "calc(85vh * 1.375)" : "80vw";
      let bookHeight = displayMode === "double" ? "85vh" : "calc(80vw / 0.6875)"

      $("#flipbook").turn({
        autoCenter:true,
        acceleration: false,
        display: displayMode,
        width: bookWidth,
        height: bookHeight,
        when: {
          turning: function(event, page, view) {
            updateNavButtons(page, view);
          },
          turned: function(event, page, view) {
            updateNavButtons(page, view);
          }
        }
      });
      $(".left-button").click(function() {
        $("#flipbook").turn("previous");
      });
      $(".right-button").click(function() {
        $("#flipbook").turn("next");
      });
      
      function updateNavButtons(page, view) {
        const lastPage = $('#flipbook').turn('pages');
        const leftBtn = displayMode === 'double' ? 
          $("#flipbookholder .left-button") : $("#mobile-nav .left-button");
        const rightBtn = displayMode === 'double' ?
          $("#flipbookholder .right-button") : $("#mobile-nav .right-button");
        
        if (page == 1)
          leftBtn.hide();
        else
          leftBtn.show();
              
        if (page == lastPage || (view.length == 2 && view[1] == lastPage)) {
          if (displayMode === "double")
            rightBtn.css("visibility", "hidden");
          else
            rightBtn.hide();
        } else {
          if (displayMode === "double")
            rightBtn.css("visibility", "visible");
          else
            rightBtn.show();
        }
      }

      function resizeBook() {
        // update display mode, width, and height in case it changed
        displayMode = $(window).width() > 600 ? "double" : "single";
        bookWidth = displayMode === "double" ? "calc(85vh * 1.375)" : "80vw";
        bookHeight = displayMode === "double" ? "85vh" : "calc(80vw / 0.6875)"
        $("#flipbook").turn("size", bookWidth, bookHeight);
      }

      // update book size when window resizes
      $(window).resize(function() {        
        resizeBook();        
      });

      const zoomIncrement = 50;

      function zoomBook(direction) {
        // direction 1 is zoom in, -1 is zoom out
        let newHeight = $("#flipbook").height();
        let newWidth =  $("#flipbook").width();

        if (displayMode === "double") {

          newHeight += direction == 1 ? zoomIncrement : -zoomIncrement;
          newWidth = 1.375 * newHeight;

        } else {

          newWidth += direction == 1 ? zoomIncrement : -zoomIncrement;
          newHeight = newWidth / 0.6875;

        }
        
        $("#flipbook").turn("size", newWidth, newHeight);
      }

      $("#zoom-in").click(function() {
        zoomBook(1);
      });

      $("#zoom-out").click(function() {
        zoomBook(-1);
      });
    </script>
  </body>
</html>